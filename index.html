<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Trainees FIEG</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Firebase (Versão Compatível) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        @media print {
            @page { margin: 1cm; size: landscape; }
            body, html, #root { 
                height: auto !important; 
                overflow: visible !important; 
                background-color: white !important;
                color: black !important;
                padding-bottom: 2cm;
            }
            .print\:hidden { display: none !important; }
            .print\:block { display: block !important; }
            .print\:text-black { color: black !important; }
            .print\:text-slate-600 { color: #475569 !important; }
            .print\:shadow-none { box-shadow: none !important; }
            .print\:border-none { border: none !important; }
            .print\:break-inside-avoid { break-inside: avoid; }
            .print\:bg-transparent { background-color: transparent !important; }
            * { -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            table { border-collapse: collapse !important; width: 100%; font-size: 10px; }
            th, td { border: 1px solid #cbd5e1 !important; padding: 4px !important; }
            th { background-color: #f1f5f9 !important; }
            .print\:fixed-footer {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                background: white;
                border-top: 1px solid #ccc;
                padding: 10px;
                font-size: 10px;
                text-align: center;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans selection:bg-indigo-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- FIREBASE CONFIG ---
        // Configuração injetada pelo ambiente ou fallback
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app';
        
        let db, auth;
        if (firebaseConfig) {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            auth = firebase.auth();
        }

        // --- ÍCONES SVG ---
        const IconBase = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>{children}</svg>
        );
        const Users = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></IconBase>;
        const UserPlus = (props) => <IconBase {...props}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></IconBase>;
        const Edit2 = (props) => <IconBase {...props}><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></IconBase>;
        const TrendingUp = (props) => <IconBase {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></IconBase>;
        const Briefcase = (props) => <IconBase {...props}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></IconBase>;
        const GraduationCap = (props) => <IconBase {...props}><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></IconBase>;
        const Building2 = (props) => <IconBase {...props}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></IconBase>;
        const X = (props) => <IconBase {...props}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></IconBase>;
        const Printer = (props) => <IconBase {...props}><polyline points="6 9 6 2 18 2 18 9"/><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"/><rect width="12" height="8" x="6" y="14"/></IconBase>;
        const FileText = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></IconBase>;
        const FileSpreadsheet = (props) => <IconBase {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><path d="M8 13h2"/><path d="M8 17h2"/><path d="M14 13h2"/><path d="M14 17h2"/></IconBase>;
        const Cloud = (props) => <IconBase {...props}><path d="M17.5 19c0-3.037-2.463-5.5-5.5-5.5S6.5 15.963 6.5 19"/><path d="M12 13.5v-8"/><path d="M12 5.5l4 4"/><path d="M12 5.5l-4 4"/></IconBase>;
        const AlertCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></IconBase>;

        // --- DADOS INICIAIS (Fallback) ---
        const initialData = [
            { id: 1, entidade: 'SESI', unidade: 'Campinas', nome: 'Gabriel Rodrigues Masson', graduacao: 'Matemática', admissao: '19/02/24', status: 'Ativo', mentor: 'Jhenifer' },
            { id: 2, entidade: 'SESI', unidade: 'Campinas', nome: 'Gustavo Aguiar Magalhães', graduacao: 'Física', admissao: '08/01/24', status: 'Ativo', mentor: 'Angelo' },
            { id: 3, entidade: 'SESI', unidade: 'Campinas', nome: 'Haryta Ferreira Borges', graduacao: 'História', admissao: '08/05/24', status: 'Ativo', mentor: 'Thiago' },
            { id: 4, entidade: 'SESI', unidade: 'Canaã', nome: 'Iza Paula Gomes Fernandes', graduacao: 'Letras - Português', admissao: '05/09/24', status: 'Ativo', mentor: 'Daiane' },
            { id: 5, entidade: 'SESI', unidade: 'Canaã', nome: 'Larissa Kristy Coelho Costa', graduacao: 'Pedagogia', admissao: '08/01/24', status: 'Ativo', mentor: 'Daiane' },
            { id: 6, entidade: 'SESI', unidade: 'Canaã', nome: 'Meirielly Ribeiro', graduacao: 'Pedagogia', admissao: '15/08/24', status: 'Ativo', mentor: 'Daiane' },
            { id: 7, entidade: 'SESI', unidade: 'Canaã', nome: 'Emily Ellen Santos', graduacao: 'Pedagogia', admissao: '01/08/24', status: 'Contratado', mentor: 'Daiane' },
            { id: 8, entidade: 'SESI', unidade: 'Catalão', nome: 'Arthur Perdiz Franco Mesquita', graduacao: 'Ciências Biológicas', admissao: '08/01/24', status: 'Ativo', mentor: 'Andreia Julio' },
            { id: 9, entidade: 'SESI', unidade: 'Jaiara', nome: 'André Fillype Freitas Nascimento', graduacao: 'Ciências da Computação', admissao: '08/01/24', status: 'Ativo', mentor: 'Sandra' },
            { id: 10, entidade: 'SESI', unidade: 'Jundiaí', nome: 'Jennifer Cristine Dornas', graduacao: 'História', admissao: '07/08/24', status: 'Ativo', mentor: 'Lindaura' },
            { id: 11, entidade: 'SESI', unidade: 'Jundiaí', nome: 'Maria Luiza Flausino Pereira', graduacao: 'Química', admissao: '01/07/24', status: 'Encerrado', mentor: '-', motivoSaida: '' },
            { id: 12, entidade: 'SESI', unidade: 'Planalto', nome: 'Adriel Silva França', graduacao: 'Educação Física', admissao: '08/07/24', status: 'Ativo', mentor: 'Junior' },
            { id: 13, entidade: 'SESI', unidade: 'Planalto', nome: 'Ana Clara Mehedin Silva Soares', graduacao: 'Pedagogia', admissao: '08/01/24', status: 'Contratado', mentor: 'Nicolas' },
            { id: 14, entidade: 'SESI', unidade: 'Planalto', nome: 'Gabriel Feitosa da Silva Ribeiro', graduacao: 'Matemática', admissao: '20/06/24', status: 'Ativo', mentor: 'Jaime' },
            { id: 15, entidade: 'SESI', unidade: 'Planalto', nome: 'Hanrry Patrick Viana de Paula', graduacao: 'Engenharia Mecânica', admissao: '08/01/24', status: 'Encerrado', mentor: 'Fernando', motivoSaida: '' },
            { id: 16, entidade: 'SESI', unidade: 'Crixás', nome: 'Amanda Godinho dos Santos', graduacao: 'Pedagogia', admissao: '19/02/24', status: 'Contratado', mentor: '-' },
            { id: 17, entidade: 'SESI', unidade: 'Rio Verde', nome: 'Lucas Andrade Lima', graduacao: 'Engenharia de Software', admissao: '08/01/24', status: 'Ativo', mentor: 'Mariceu' },
            { id: 18, entidade: 'SESI', unidade: 'Itumbiara', nome: 'Mateus Divino Rodrigues Ferreira', graduacao: 'Matemática', admissao: '08/01/24', status: 'Encerrado', mentor: '-', motivoSaida: '' },
            { id: 19, entidade: 'SESI', unidade: 'Rio Verde', nome: 'Maria Victória Ferreira Lopes', graduacao: 'Química', admissao: '06/03/25', status: 'Ativo', mentor: 'Mariceu' },
            { id: 20, entidade: 'SESI', unidade: 'Niquelândia', nome: 'Joaquim Pereira da Silva Junior', graduacao: '-', admissao: '19/02/24', status: 'Encerrado', mentor: '-', motivoSaida: '' },
            { id: 21, entidade: 'SESI', unidade: 'Canaã', nome: 'Nikolle Alexandre Chaves', graduacao: 'Pedagogia', admissao: '15/07/25', status: 'Ativo', mentor: 'Maria Carolina' },
            { id: 22, entidade: 'SESI', unidade: 'Planalto', nome: 'Rafaella Nunes de Sousa', graduacao: '-', admissao: '09/06/25', status: 'Ativo', mentor: '-' },
            { id: 23, entidade: 'SESI', unidade: 'Planalto', nome: 'José Gustavo Santana de Oliveira', graduacao: '-', admissao: '04/09/25', status: 'Ativo', mentor: '-' },
            { id: 24, entidade: 'SESI', unidade: 'Canaã', nome: 'Ana Julia de Almeida Pereira', graduacao: '-', admissao: '15/09/25', status: 'Ativo', mentor: '-' },
            { id: 25, entidade: 'SESI', unidade: 'Colorado', nome: 'Sarah de Jesus Martins', graduacao: '-', admissao: '09/09/25', status: 'Ativo', mentor: '-' },
            // ...SENAI (abreviado para manter o foco)
            { id: 26, entidade: 'SENAI', unidade: 'Canaã', nome: 'Gabriel Rodrigues de Morais', graduacao: 'Física Médica', admissao: '19/02/24', status: 'Encerrado', mentor: '-', motivoSaida: '' },
            { id: 27, entidade: 'SENAI', unidade: 'Catalão', nome: 'Alexandre Ferreira de Carvalho', graduacao: 'Engenharia Mecânica', admissao: '09/08/24', status: 'Ativo', mentor: 'Leonardo Pereira' },
            { id: 30, entidade: 'SENAI', unidade: 'Charuri', nome: 'Marcos Henrique Rodrigues Porto', graduacao: 'Engenharia Elétrica', admissao: '08/01/24', status: 'Encerrado', mentor: '-', motivoSaida: 'Término de contrato' },
        ];

        // --- COMPONENTES UI ---
        const MetricCard = ({ title, value, icon: Icon, colorClass, subtext }) => (
            <div className="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 flex items-start justify-between">
                <div>
                    <p className="text-sm font-medium text-slate-500 uppercase tracking-wider print:text-black">{title}</p>
                    <h3 className="text-3xl font-bold text-slate-800 mt-2 print:text-black">{value}</h3>
                    {subtext && <p className="text-xs text-slate-400 mt-1 print:text-slate-600">{subtext}</p>}
                </div>
                <div className={`p-3 rounded-xl ${colorClass} print:bg-transparent print:border print:border-slate-200`}>
                    <Icon className="w-6 h-6 text-white print:text-black" />
                </div>
            </div>
        );

        const StatusBadge = ({ status }) => {
            const styles = {
                'Ativo': 'bg-emerald-100 text-emerald-800 border-emerald-200',
                'Contratado': 'bg-blue-100 text-blue-800 border-blue-200',
                'Contratada': 'bg-blue-100 text-blue-800 border-blue-200',
                'Encerrado': 'bg-slate-100 text-slate-600 border-slate-200',
            };
            const normalizedStatus = status === 'Contratada' ? 'Contratado' : status;
            return <span className={`px-3 py-1 rounded-full text-xs font-semibold border print:border-slate-400 print:text-black print:bg-transparent ${styles[status] || 'bg-gray-100 text-gray-800'}`}>{normalizedStatus}</span>;
        };

        function App() {
            const [collaborators, setCollaborators] = useState([]);
            const [loading, setLoading] = useState(true);
            const [searchTerm, setSearchTerm] = useState('');
            const [isModalOpen, setIsModalOpen] = useState(false);
            const [currentCollaborator, setCurrentCollaborator] = useState(null);
            const [user, setUser] = useState(null);
            const [isSaving, setIsSaving] = useState(false);

            // Filtros
            const [filterEntidade, setFilterEntidade] = useState('Todas');
            const [filterUnidade, setFilterUnidade] = useState('Todas');
            const [filterGraduacao, setFilterGraduacao] = useState('Todas');
            const [filterStatus, setFilterStatus] = useState('Todos');

            // Formulário
            const [formData, setFormData] = useState({
                nome: '', entidade: 'SESI', unidade: '', graduacao: '', admissao: '', status: 'Ativo', mentor: '', motivoSaida: ''
            });

            // --- FIREBASE LOGIC ---
            useEffect(() => {
                if (!firebaseConfig) {
                    // Fallback se não houver backend
                    setCollaborators(initialData);
                    setLoading(false);
                    return;
                }

                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        await auth.signInWithCustomToken(__initial_auth_token);
                    } else {
                        await auth.signInAnonymously();
                    }
                };

                initAuth();
                const unsubscribeAuth = auth.onAuthStateChanged((u) => {
                    setUser(u);
                    if (u) {
                        // Listener para dados em tempo real
                        const docRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('trainees').doc('list');
                        const unsubscribeData = docRef.onSnapshot((doc) => {
                            if (doc.exists) {
                                setCollaborators(doc.data().data || []);
                            } else {
                                // Se não existe, cria com dados iniciais
                                docRef.set({ data: initialData });
                                setCollaborators(initialData);
                            }
                            setLoading(false);
                        }, (error) => {
                            console.error("Erro ao carregar dados:", error);
                            setLoading(false);
                        });
                        return () => unsubscribeData();
                    }
                });
                return () => unsubscribeAuth();
            }, []);

            // --- SALVAR NA NUVEM ---
            const saveToCloud = async (newData) => {
                if (!db || !user) return;
                setIsSaving(true);
                try {
                    const docRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('trainees').doc('list');
                    await docRef.set({ data: newData });
                    alert('Dados salvos e sincronizados na nuvem com sucesso! O link agora mostra a versão atualizada.');
                } catch (error) {
                    console.error("Erro ao salvar:", error);
                    alert("Erro ao salvar na nuvem.");
                } finally {
                    setIsSaving(false);
                }
            };

            // --- LÓGICA DE FILTROS ---
            const uniqueEntidades = useMemo(() => ['Todas', ...new Set(collaborators.map(c => c.entidade).filter(Boolean).sort())], [collaborators]);
            const uniqueUnidades = useMemo(() => ['Todas', ...new Set(collaborators.map(c => c.unidade).filter(Boolean).sort())], [collaborators]);
            const uniqueGraduacoes = useMemo(() => ['Todas', ...new Set(collaborators.map(c => c.graduacao).filter(Boolean).sort())], [collaborators]);

            const filteredCollaborators = useMemo(() => {
                return collaborators.filter(colab => {
                    const matchesSearch = (colab.nome || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                                          (colab.unidade || '').toLowerCase().includes(searchTerm.toLowerCase()) ||
                                          (colab.graduacao || '').toLowerCase().includes(searchTerm.toLowerCase());
                    
                    const matchesEntidade = filterEntidade === 'Todas' || colab.entidade === filterEntidade;
                    const matchesUnidade = filterUnidade === 'Todas' || colab.unidade === filterUnidade;
                    const matchesGraduacao = filterGraduacao === 'Todas' || colab.graduacao === filterGraduacao;
                    const matchesStatus = filterStatus === 'Todos' || 
                                          (filterStatus === 'Contratado' ? (colab.status === 'Contratado' || colab.status === 'Contratada') : colab.status === filterStatus);

                    return matchesSearch && matchesEntidade && matchesUnidade && matchesGraduacao && matchesStatus;
                });
            }, [collaborators, searchTerm, filterEntidade, filterUnidade, filterGraduacao, filterStatus]);

            const stats = useMemo(() => {
                return {
                    total: filteredCollaborators.length,
                    sesi: filteredCollaborators.filter(c => c.entidade === 'SESI').length,
                    senai: filteredCollaborators.filter(c => c.entidade === 'SENAI').length,
                    ativos: filteredCollaborators.filter(c => c.status === 'Ativo').length,
                    contratados: filteredCollaborators.filter(c => c.status === 'Contratado' || c.status === 'Contratada').length,
                };
            }, [filteredCollaborators]);

            // --- HANDLERS ---
            const handleOpenModal = (collaborator = null) => {
                if (collaborator) {
                    setFormData(collaborator);
                    setCurrentCollaborator(collaborator);
                } else {
                    setFormData({ nome: '', entidade: 'SESI', unidade: '', graduacao: '', admissao: '', status: 'Ativo', mentor: '', motivoSaida: '' });
                    setCurrentCollaborator(null);
                }
                setIsModalOpen(true);
            };

            const handleLocalSave = (e) => {
                e.preventDefault();
                let newData;
                if (currentCollaborator) {
                    newData = collaborators.map(c => c.id === currentCollaborator.id ? { ...formData, id: c.id } : c);
                } else {
                    const newId = Math.max(...collaborators.map(c => c.id), 0) + 1;
                    newData = [...collaborators, { ...formData, id: newId }];
                }
                setCollaborators(newData);
                setIsModalOpen(false);
                // Auto-save localmente, mas força nuvem no botão do header
            };

            const handleGlobalSave = () => {
                saveToCloud(collaborators);
            };

            const handlePrint = () => window.print();

            const handleExportExcel = () => {
                const tableContent = `
                    <html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">
                    <head><meta charset="utf-8" /><style>table{border-collapse:collapse;width:100%}th,td{border:1px solid #000;padding:5px;text-align:left}th{background-color:#f2f2f2}</style></head>
                    <body>
                        <table>
                            <thead><tr><th>Nome</th><th>Entidade</th><th>Unidade</th><th>Graduação</th><th>Admissão</th><th>Status</th><th>Motivo Saída</th><th>Mentor</th></tr></thead>
                            <tbody>
                                ${filteredCollaborators.map(c => `
                                    <tr>
                                        <td>${c.nome}</td><td>${c.entidade}</td><td>${c.unidade}</td><td>${c.graduacao}</td><td>${c.admissao}</td><td>${c.status}</td><td>${c.motivoSaida || ''}</td><td>${c.mentor}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </body></html>`;
                const blob = new Blob([tableContent], { type: 'application/vnd.ms-excel' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.setAttribute('download', `trainees_${new Date().toISOString().slice(0,10)}.xls`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            if (loading) return <div className="min-h-screen flex items-center justify-center text-slate-500">Carregando dados...</div>;

            return (
                <div className="min-h-screen pb-20 print:pb-0">
                    <header className="bg-white border-b border-slate-200 sticky top-0 z-20 print:hidden">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <div className="bg-indigo-600 p-2 rounded-lg"><Users className="w-6 h-6 text-white" /></div>
                                <h1 className="text-xl font-bold tracking-tight text-slate-900">Portal de Trainees</h1>
                            </div>
                            <div className="flex items-center gap-4">
                                <button onClick={handleGlobalSave} disabled={isSaving} className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm disabled:opacity-50">
                                    <Cloud className="w-4 h-4" />
                                    <span className="hidden sm:inline">{isSaving ? 'Salvando...' : 'Salvar na Nuvem'}</span>
                                </button>
                                <div className="h-6 w-px bg-slate-200 mx-1"></div>
                                <button onClick={handleExportExcel} className="flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm">
                                    <FileSpreadsheet className="w-4 h-4" />
                                    <span className="hidden sm:inline">Excel</span>
                                </button>
                                <button onClick={handlePrint} className="flex items-center gap-2 bg-slate-800 hover:bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors shadow-sm">
                                    <FileText className="w-4 h-4" />
                                    <span className="hidden sm:inline">PDF</span>
                                </button>
                            </div>
                        </div>
                    </header>

                    <div className="hidden print:block mb-6 text-center border-b pb-4 pt-4">
                        <h1 className="text-2xl font-bold text-black">Relatório de Profissionais</h1>
                        <p className="text-sm text-slate-600">Filtros: {filterEntidade} | {filterUnidade} | {filterStatus}</p>
                    </div>

                    <main className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8 print:p-0 print:w-full print:max-w-none">
                        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                            <MetricCard title="Total Listado" value={stats.total} icon={Users} colorClass="bg-indigo-600" />
                            <MetricCard title="SESI" value={stats.sesi} icon={Building2} colorClass="bg-green-600" subtext="Colaboradores SESI" />
                            <MetricCard title="SENAI" value={stats.senai} icon={Building2} colorClass="bg-orange-500" subtext="Colaboradores SENAI" />
                            <MetricCard title="Em Programa" value={stats.ativos} icon={TrendingUp} colorClass="bg-emerald-500" subtext="Ativos" />
                            <MetricCard title="Contratados" value={stats.contratados} icon={Briefcase} colorClass="bg-purple-500" subtext="Efetivados" />
                        </div>

                        <div className="flex flex-col gap-4 p-4 rounded-xl border border-slate-200 bg-white shadow-sm transition-colors print:hidden">
                            <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                                <div className="relative w-full sm:w-96">
                                    <div className="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><Search className="h-5 w-5 text-slate-400" /></div>
                                    <input type="text" placeholder="Buscar..." className="pl-10 w-full rounded-lg text-sm focus:ring-indigo-500 focus:border-indigo-500 py-2.5 transition-colors border-slate-200 bg-slate-50" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                </div>
                                <div className="flex items-center gap-2 w-full sm:w-auto overflow-x-auto pb-1 sm:pb-0">
                                    <div className="flex items-center rounded-lg p-1 border flex-nowrap bg-slate-50 border-slate-200">
                                        {['Todos', 'Ativo', 'Contratado', 'Encerrado'].map((status) => (
                                            <button key={status} onClick={() => setFilterStatus(status)} className={`px-3 py-1.5 text-xs font-medium rounded-md whitespace-nowrap transition-all ${filterStatus === status ? 'bg-white text-indigo-700 shadow-sm border border-slate-100' : 'text-slate-500 hover:text-slate-700'}`}>{status}</button>
                                        ))}
                                    </div>
                                </div>
                            </div>
                            <div className="flex flex-col md:flex-row gap-4 items-end md:items-center justify-between border-t border-slate-100 pt-4">
                                <div className="flex flex-col sm:flex-row gap-2 w-full md:w-auto">
                                    <select className="rounded-lg border-slate-200 text-sm py-2" value={filterEntidade} onChange={(e) => setFilterEntidade(e.target.value)}>{uniqueEntidades.map(u => <option key={u} value={u}>{u}</option>)}</select>
                                    <select className="rounded-lg border-slate-200 text-sm py-2" value={filterUnidade} onChange={(e) => setFilterUnidade(e.target.value)}>{uniqueUnidades.map(u => <option key={u} value={u}>{u}</option>)}</select>
                                    <select className="rounded-lg border-slate-200 text-sm py-2" value={filterGraduacao} onChange={(e) => setFilterGraduacao(e.target.value)}>{uniqueGraduacoes.map(u => <option key={u} value={u}>{u}</option>)}</select>
                                </div>
                                <button onClick={() => handleOpenModal()} className="flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2.5 rounded-lg text-sm font-medium transition-colors shadow-sm whitespace-nowrap">
                                    <UserPlus className="w-4 h-4" /> <span>Novo Profissional</span>
                                </button>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden print:shadow-none print:border-none print:rounded-none">
                            <div className="overflow-x-auto">
                                <table className="w-full text-left border-collapse">
                                    <thead>
                                        <tr className="bg-slate-50 border-b border-slate-200 print:bg-white print:border-black">
                                            <th className="px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Profissional</th>
                                            <th className="px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Entidade / Unidade</th>
                                            <th className="px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Formação</th>
                                            <th className="px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Status</th>
                                            <th className="px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider">Mentor</th>
                                            <th className="px-6 py-4 text-xs font-semibold text-slate-500 uppercase tracking-wider text-right print:hidden">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 print:divide-slate-200">
                                        {filteredCollaborators.length > 0 ? (
                                            filteredCollaborators.map((item) => (
                                                <tr key={item.id} className="hover:bg-slate-50 transition-colors group print:hover:bg-transparent break-inside-avoid">
                                                    <td className="px-6 py-4">
                                                        <div className="flex items-center gap-3">
                                                            <div className="h-10 w-10 rounded-full flex items-center justify-center font-bold text-sm border bg-indigo-50 text-indigo-600 border-indigo-100 print:hidden">{item.nome.charAt(0)}</div>
                                                            <div>
                                                                <p className="text-sm font-semibold text-slate-900">{item.nome}</p>
                                                                <p className="text-xs text-slate-500 print:text-black">{item.admissao}</p>
                                                                {item.status === 'Encerrado' && item.motivoSaida && <p className="text-xs text-red-500 mt-1 font-medium block">Motivo: {item.motivoSaida}</p>}
                                                            </div>
                                                        </div>
                                                    </td>
                                                    <td className="px-6 py-4">
                                                        <span className={`text-xs font-bold w-fit px-1.5 py-0.5 rounded mb-1 print:border print:border-black print:bg-transparent print:text-black ${item.entidade === 'SESI' ? 'bg-green-50 text-green-700' : 'bg-orange-50 text-orange-700'}`}>{item.entidade}</span>
                                                        <br/><span className="text-sm text-slate-600 print:text-black">{item.unidade}</span>
                                                    </td>
                                                    <td className="px-6 py-4"><span className="text-sm text-slate-700 print:text-black">{item.graduacao || '-'}</span></td>
                                                    <td className="px-6 py-4"><StatusBadge status={item.status} /></td>
                                                    <td className="px-6 py-4"><span className="text-sm text-slate-600 print:text-black">{item.mentor || '-'}</span></td>
                                                    <td className="px-6 py-4 text-right print:hidden">
                                                        <button onClick={() => handleOpenModal(item)} className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-md transition-colors"><Edit2 className="w-4 h-4" /></button>
                                                    </td>
                                                </tr>
                                            ))
                                        ) : (
                                            <tr><td colSpan="6" className="px-6 py-12 text-center text-slate-400">Nenhum profissional encontrado.</td></tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                            <div className="bg-slate-50 px-6 py-3 border-t border-slate-200 flex justify-between items-center text-xs text-slate-500 print:hidden">
                                <span>Mostrando {filteredCollaborators.length} registros</span>
                            </div>
                        </div>
                    </main>

                    <div className="hidden print:fixed-footer">
                        <div className="flex justify-between items-center w-full max-w-7xl mx-auto px-4">
                            <span>Sistema de Gestão de Trainees - FIEG</span>
                            <span>Gerado em: {new Date().toLocaleString()}</span>
                        </div>
                    </div>

                    {isModalOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/50 backdrop-blur-sm p-4 print:hidden">
                            <div className="bg-white rounded-2xl shadow-xl w-full max-w-lg border border-slate-200">
                                <div className="flex items-center justify-between px-6 py-4 border-b border-slate-100">
                                    <h2 className="text-lg font-bold text-slate-900">{currentCollaborator ? 'Editar' : 'Novo'} Profissional</h2>
                                    <button onClick={() => setIsModalOpen(false)} className="text-slate-400 hover:text-slate-600"><X className="w-5 h-5" /></button>
                                </div>
                                <form onSubmit={handleLocalSave} className="p-6 space-y-4">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div className="col-span-2">
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Nome</label>
                                            <input required type="text" className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.nome} onChange={e => setFormData({...formData, nome: e.target.value})} />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Entidade</label>
                                            <select className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.entidade} onChange={e => setFormData({...formData, entidade: e.target.value})}>
                                                <option value="SESI">SESI</option><option value="SENAI">SENAI</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Unidade</label>
                                            <input type="text" className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.unidade} onChange={e => setFormData({...formData, unidade: e.target.value})} />
                                        </div>
                                        <div className="col-span-2">
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Graduação</label>
                                            <input type="text" className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.graduacao} onChange={e => setFormData({...formData, graduacao: e.target.value})} />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Admissão</label>
                                            <input type="text" placeholder="dd/mm/aaaa" className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.admissao} onChange={e => setFormData({...formData, admissao: e.target.value})} />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Status</label>
                                            <select className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.status} onChange={e => setFormData({...formData, status: e.target.value})}>
                                                <option value="Ativo">Ativo</option>
                                                <option value="Contratado">Contratado</option>
                                                <option value="Encerrado">Encerrado</option>
                                            </select>
                                        </div>
                                        {/* CAMPO NOVO: MOTIVO DA SAÍDA (Aparece apenas se Encerrado) */}
                                        {formData.status === 'Encerrado' && (
                                            <div className="col-span-2 bg-red-50 p-3 rounded-lg border border-red-100">
                                                <label className="block text-xs font-bold text-red-500 uppercase mb-1 flex items-center gap-1">
                                                    <AlertCircle className="w-3 h-3"/> Motivo da Saída
                                                </label>
                                                <input 
                                                    type="text" 
                                                    className="w-full rounded-md border-red-200 py-2 text-sm focus:border-red-500 focus:ring-red-500" 
                                                    placeholder="Descreva o motivo..."
                                                    value={formData.motivoSaida || ''} 
                                                    onChange={e => setFormData({...formData, motivoSaida: e.target.value})} 
                                                />
                                            </div>
                                        )}
                                        <div className="col-span-2">
                                            <label className="block text-xs font-bold text-slate-500 uppercase">Mentor</label>
                                            <input type="text" className="w-full rounded-lg border-slate-300 py-2 text-sm" value={formData.mentor} onChange={e => setFormData({...formData, mentor: e.target.value})} />
                                        </div>
                                    </div>
                                    <div className="flex gap-3 pt-4 border-t border-slate-100 mt-6">
                                        <button type="button" onClick={() => setIsModalOpen(false)} className="flex-1 px-4 py-2 text-sm font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 rounded-lg">Cancelar</button>
                                        <button type="submit" className="flex-1 px-4 py-2 text-sm font-semibold text-white bg-indigo-600 hover:bg-indigo-700 rounded-lg">Salvar Temporariamente</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
